<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manajemen Inventaris | Resto Admin</title>
    <link rel="stylesheet" href="../shared/css/global.css">
    <link rel="stylesheet" href="css/admin.css">
    <link rel="stylesheet" href="css/inventory.css">
</head>
<body>
    <div class="admin-layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1 class="logo">RestoAdmin</h1>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="/admin/">Dashboard</a></li>
                    <li><a href="/admin/pos.html">POS</a></li>
                    <li><a href="/admin/orders.html">Pesanan</a></li>
                    
                    <li><a href="/admin/menu.html">Menu</a></li>
                    <li class="active"><a href="/admin/inventory.html">Inventaris</a></li>
                    <li><a href="/admin/reports.html">Laporan</a></li>
                    <li><a href="/admin/settings.html">Pengaturan</a></li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <div class="user-profile">
                    <span id="user-email"></span>
                    <button id="logout-btn">Logout</button>
                </div>
            </div>
        </aside>
        <main class="main-content">
            <header class="main-header">
                <h2>Manajemen Inventaris</h2>
                <div id="status-banner" class="status-banner">
                    <span id="connection-status" class="status-dot status-offline" title="Status Koneksi"></span>
                    Role: <strong id="user-role">...</strong>
                </div>
            </header>
            <div class="content-area">
                <nav class="tabs">
                    <button class="tab-link active" data-tab="on-hand">On-Hand</button>
                    <button class="tab-link" data-tab="ingredients">Ingredients</button>
                    <button class="tab-link" data-tab="suppliers">Suppliers</button>
                    <button class="tab-link" data-tab="bom-menu">BOM (Menu)</button>
                    <button class="tab-link" data-tab="bom-option">BOM (Option)</button>
                    <button class="tab-link" data-tab="ledger">Ledger</button>
                </nav>

                <div id="tab-content-container">
                    <!-- On-Hand Tab -->
                    <div id="on-hand-tab" class="tab-content active">
                        <div class="toolbar">
                            <input type="search" id="on-hand-search" placeholder="Cari bahan...">
                            <select id="on-hand-sort">
                                <option value="name_asc">Nama (A-Z)</option>
                                <option value="name_desc">Nama (Z-A)</option>
                                <option value="qty_asc">Qty (Rendah ke Tinggi)</option>
                                <option value="qty_desc">Qty (Tinggi ke Rendah)</option>
                            </select>
                            <button id="export-on-hand-csv" class="btn">Ekspor CSV</button>
                        </div>
                        <div id="low-stock-banner" class="banner banner-warning" style="display: none;">
                            Ada item dengan stok di bawah minimum!
                        </div>
                        <div class="table-container">
                            <table class="data-table" id="on-hand-table">
                                <thead>
                                    <tr>
                                        <th>Nama Bahan</th>
                                        <th>Qty On Hand</th>
                                        <th>Unit</th>
                                        <th>Min Stock</th>
                                        <th>Cost/Unit</th>
                                        <th>Stock Value</th>
                                    </tr>
                                </thead>
                                <tbody id="on-hand-table-body"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Ingredients Tab -->
                    <div id="ingredients-tab" class="tab-content">
                        <div class="toolbar">
                            <input type="search" id="ingredients-search" placeholder="Cari bahan...">
                            <button id="add-ingredient-btn" class="btn btn-primary write-access">Tambah Bahan</button>
                        </div>
                        <div class="table-container">
                            <table class="data-table" id="ingredients-table">
                                <thead>
                                    <tr>
                                        <th>Nama</th>
                                        <th>Unit</th>
                                        <th>SKU</th>
                                        <th>Min Stock</th>
                                        <th>Cost/Unit</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="ingredients-table-body"></tbody>
                            </table>
                        </div>
                        <div class="pagination" id="ingredients-pagination"></div>
                    </div>

                    <!-- Suppliers Tab -->
                    <div id="suppliers-tab" class="tab-content">
                         <div class="toolbar">
                            <input type="search" id="suppliers-search" placeholder="Cari supplier...">
                            <button id="add-supplier-btn" class="btn btn-primary write-access">Tambah Supplier</button>
                        </div>
                        <div class="table-container">
                            <table class="data-table" id="suppliers-table">
                                <thead>
                                    <tr>
                                        <th>Nama</th>
                                        <th>Kontak</th>
                                        <th>Catatan</th>
                                        <th>Dibuat</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="suppliers-table-body"></tbody>
                            </table>
                        </div>
                        <div class="pagination" id="suppliers-pagination"></div>
                    </div>

                    <!-- BOM Menu Tab -->
                    <div id="bom-menu-tab" class="tab-content">
                        <div class="bom-layout">
                            <div class="bom-selector-panel">
                                <h3>Pilih Menu</h3>
                                <select id="bom-menu-select"></select>
                                <button id="add-bom-menu-item-btn" class="btn btn-primary write-access" disabled>Tambah Bahan ke Resep</button>
                            </div>
                            <div class="bom-details-panel">
                                <h3 id="bom-menu-title">Pilih menu untuk melihat resep</h3>
                                <div class="table-container">
                                    <table class="data-table" id="bom-menu-table">
                                        <thead>
                                            <tr>
                                                <th>Bahan</th>
                                                <th>Qty</th>
                                                <th>Unit</th>
                                                <th>Aksi</th>
                                            </tr>
                                        </thead>
                                        <tbody id="bom-menu-table-body"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- BOM Option Tab -->
                    <div id="bom-option-tab" class="tab-content">
                        <div class="bom-layout">
                            <div class="bom-selector-panel">
                                <h3>Pilih Opsi/Add-on</h3>
                                <select id="bom-option-select"></select>
                                <button id="add-bom-option-item-btn" class="btn btn-primary write-access" disabled>Tambah Bahan ke Resep</button>
                            </div>
                            <div class="bom-details-panel">
                                <h3 id="bom-option-title">Pilih opsi untuk melihat resep</h3>
                                <div class="table-container">
                                    <table class="data-table" id="bom-option-table">
                                        <thead>
                                            <tr>
                                                <th>Bahan</th>
                                                <th>Qty</th>
                                                <th>Unit</th>
                                                <th>Aksi</th>
                                            </tr>
                                        </thead>
                                        <tbody id="bom-option-table-body"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ledger Tab -->
                    <div id="ledger-tab" class="tab-content">
                        <div class="toolbar">
                            <input type="date" id="ledger-date-from">
                            <input type="date" id="ledger-date-to">
                            <select id="ledger-ingredient-filter"></select>
                            <select id="ledger-movement-filter">
                                <option value="">Semua Pergerakan</option>
                                <option value="purchase">Purchase</option>
                                <option value="adjustment">Adjustment</option>
                                <option value="sale_deduct">Sale Deduct</option>
                                <option value="waste">Waste</option>
                                <option value="return">Return</option>
                            </select>
                            <button id="ledger-filter-btn" class="btn">Filter</button>
                            <button id="add-ledger-entry-btn" class="btn btn-primary write-access">Catat Stok</button>
                            <button id="export-ledger-csv" class="btn">Ekspor CSV</button>
                        </div>
                        <div class="table-container">
                            <table class="data-table" id="ledger-table">
                                <thead>
                                    <tr>
                                        <th>Waktu</th>
                                        <th>Pergerakan</th>
                                        <th>Bahan</th>
                                        <th>Qty</th>
                                        <th>Unit</th>
                                        <th>Supplier</th>
                                        <th>Catatan</th>
                                        <th>Oleh</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="ledger-table-body"></tbody>
                            </table>
                        </div>
                        <div class="pagination" id="ledger-pagination"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="ingredient-modal" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 id="ingredient-modal-title">Tambah Bahan Baru</h3>
                <button class="close-button">&times;</button>
            </div>
            <div class="modal-body">
                <form id="ingredient-form" novalidate>
                    <input type="hidden" id="ingredient-id" name="ingredient-id">
                    <div class="form-group">
                        <label for="ingredient-name">Nama Bahan</label>
                        <input type="text" id="ingredient-name" name="ingredient-name" required minlength="2">
                        <div class="error-message"></div>
                    </div>
                    <div class="form-group">
                        <label for="ingredient-unit">Unit</label>
                        <select id="ingredient-unit" name="ingredient-unit" required>
                            <option value="g">g (gram)</option>
                            <option value="kg">kg (kilogram)</option>
                            <option value="ml">ml (mililiter)</option>
                            <option value="l">l (liter)</option>
                            <option value="pcs">pcs (pieces)</option>
                            <option value="pack">pack</option>
                        </select>
                        <div class="error-message"></div>
                    </div>
                    <div class="form-group">
                        <label for="ingredient-sku">SKU (Opsional)</label>
                        <input type="text" id="ingredient-sku" name="ingredient-sku">
                    </div>
                    <div class="form-group">
                        <label for="ingredient-min-stock">Min Stock</label>
                        <input type="number" id="ingredient-min-stock" name="ingredient-min-stock" required min="0" value="0">
                        <div class="error-message"></div>
                    </div>
                    <div class="form-group">
                        <label for="ingredient-cost">Cost per Unit</label>
                        <input type="number" id="ingredient-cost" name="ingredient-cost" required min="0" value="0">
                        <div class="error-message"></div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary cancel-btn">Batal</button>
                        <button type="submit" class="btn btn-primary save-btn write-access">Simpan</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div id="supplier-modal" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 id="supplier-modal-title">Tambah Supplier Baru</h3>
                <button class="close-button">&times;</button>
            </div>
            <div class="modal-body">
                <form id="supplier-form" novalidate>
                    <input type="hidden" id="supplier-id" name="supplier-id">
                    <div class="form-group">
                        <label for="supplier-name">Nama Supplier</label>
                        <input type="text" id="supplier-name" name="supplier-name" required minlength="2">
                        <div class="error-message"></div>
                    </div>
                    <div class="form-group">
                        <label for="supplier-contact">Kontak (Opsional)</label>
                        <input type="text" id="supplier-contact" name="supplier-contact">
                    </div>
                    <div class="form-group">
                        <label for="supplier-note">Catatan (Opsional)</label>
                        <textarea id="supplier-note" name="supplier-note" rows="3"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary cancel-btn">Batal</button>
                        <button type="submit" class="btn btn-primary save-btn write-access">Simpan</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="ledger-entry-modal" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 id="ledger-modal-title">Catat Pergerakan Stok</h3>
                <button class="close-button">&times;</button>
            </div>
            <div class="modal-body">
                <form id="ledger-entry-form" novalidate>
                    <input type="hidden" id="ledger-id" name="ledger-id">
                    <div class="form-group">
                        <label for="ledger-movement">Tipe Pergerakan</label>
                        <select id="ledger-movement" name="ledger-movement" required>
                            <option value="purchase">Purchase (+)</option>
                            <option value="adjustment">Adjustment (+/-)</option>
                            <option value="waste">Waste (-)</option>
                            <option value="return">Return (-)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="ledger-ingredient">Bahan</label>
                        <select id="ledger-ingredient" name="ledger-ingredient" required></select>
                    </div>
                    <div class="form-group">
                        <label for="ledger-qty">Kuantitas</label>
                        <input type="number" id="ledger-qty" name="ledger-qty" required>
                        <div class="error-message"></div>
                    </div>
                    <div class="form-group">
                        <label for="ledger-unit">Unit</label>
                        <input type="text" id="ledger-unit" name="ledger-unit" required>
                    </div>
                    <div class="form-group" id="ledger-supplier-group">
                        <label for="ledger-supplier">Supplier (Opsional)</label>
                        <select id="ledger-supplier" name="ledger-supplier"></select>
                    </div>
                    <div class="form-group">
                        <label for="ledger-note">Catatan (Opsional)</label>
                        <textarea id="ledger-note" name="ledger-note" rows="2"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary cancel-btn">Batal</button>
                        <button type="submit" class="btn btn-primary save-btn write-access">Simpan</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="bom-item-modal" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 id="bom-item-modal-title">Tambah Bahan Resep</h3>
                <button class="close-button">&times;</button>
            </div>
            <div class="modal-body">
                <form id="bom-item-form" novalidate>
                    <input type="hidden" id="bom-entity-id" name="bom-entity-id">
                    <input type="hidden" id="bom-entity-type" name="bom-entity-type"> <!-- 'menu' or 'option' -->
                    <div class="form-group">
                        <label for="bom-ingredient">Bahan</label>
                        <select id="bom-ingredient" name="bom-ingredient" required></select>
                    </div>
                    <div class="form-group">
                        <label for="bom-qty">Kuantitas</label>
                        <input type="number" id="bom-qty" name="bom-qty" required min="0.01" step="any">
                        <div class="error-message"></div>
                    </div>
                    <div class="form-group">
                        <label for="bom-unit">Unit</label>
                        <input type="text" id="bom-unit" name="bom-unit" required readonly>
                        <small>Unit diambil dari data bahan.</small>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary cancel-btn">Batal</button>
                        <button type="submit" class="btn btn-primary save-btn write-access">Simpan</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="toast-container"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="module" src="js/main.js"></script>
    <script type="module" src="js/inventory.js"></script>
</body>
</html>
